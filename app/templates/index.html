{% extends 'base.html' %}

{% block content %}
  {% if folder %}
    <h1>Folder: {{ folder }}</h1>
    <p><a href="/gallery">‚Üê Back to gallery</a></p>
    <p>
      <a href="/upload?folder={{ folder }}">Upload to {{ folder }}</a>
    </p>
    <form action="/gallery/{{ folder }}/rename" method="post" class="ajax-form ajax-rename-folder">
      <label>Rename folder: <input name="new_name" placeholder="New name"></label>
      <button type="submit">Rename</button>
    </form>
    <form action="/gallery/{{ folder }}/delete" method="post" class="ajax-form ajax-delete-folder" onsubmit="return confirm('Delete folder and all images?')">
      <button type="submit">Delete folder</button>
    </form>
    {% if images %}
      <div class="grid">
      {% for img in images %}
        <figure>
          <a href="{{ img.url }}"><img src="{{ img.thumb if img.thumb else img.url }}" alt="{{ img.name }}"></a>
          <div class="img-actions">
            <button class="btn-exif" data-folder="{{ folder }}" data-filename="{{ img.name }}">EXIF</button>
            <form action="/gallery/{{ folder }}/delete_image" method="post" class="ajax-form ajax-delete-image">
              <input type="hidden" name="filename" value="{{ img.name }}">
              <button type="submit">Remove</button>
            </form>
          </div>
        </figure>
      {% endfor %}
      </div>
    {% else %}
      <p>No images in this folder yet.</p>
    {% endif %}
  {% else %}
    <h1>Gallery</h1>
    <form action="/gallery/create_folder" method="post" class="ajax-form ajax-create-folder">
      <label>Create folder: <input name="name" placeholder="Folder name"></label>
      <button type="submit">Create</button>
    </form>
    {% if folders %}
      <h2>Folders</h2>
      <ul>
        {% for f in folders %}
          <li><a href="/gallery?folder={{ f.name }}">{{ f.name }}</a></li>
        {% endfor %}
      </ul>
    {% endif %}
    {% if images %}
      <h2>Root images</h2>
      <div class="grid">
      {% for img in images %}
        <figure>
          <a href="{{ img.url }}"><img src="{{ img.thumb if img.thumb else img.url }}" alt="{{ img.name }}"></a>
        </figure>
      {% endfor %}
      </div>
    {% else %}
      <p>No images yet. <a href="/upload">Upload one</a>.</p>
    {% endif %}
  {% endif %}
{% endblock %}

{% block scripts %}
  <script src="/static/js/gallery.js" defer></script>
{% endblock %}
