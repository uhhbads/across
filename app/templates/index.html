{% extends 'base.html' %}

{% block content %}
  {% if folder %}
    <h1>Folder: {{ folder }}</h1>
    <p><a href="/gallery">‚Üê Back to gallery</a></p>
    <p>
      <a href="/upload?folder={{ folder }}">Upload to {{ folder }}</a>
    </p>
    <form action="/gallery/{{ folder }}/rename" method="post" class="ajax-form ajax-rename-folder">
      <label>Rename folder: <input name="new_name" placeholder="New name"></label>
      <button type="submit">Rename</button>
    </form>
    <form action="/gallery/{{ folder }}/delete" method="post" class="ajax-form ajax-delete-folder" onsubmit="return confirm('Delete folder and all images?')">
      <button type="submit">Delete folder</button>
    </form>
    {% if images %}
      <div class="grid">
      {% for img in images %}
        <figure>
          <a href="{{ img.url }}" class="img-link" data-full="{{ img.url }}" data-filename="{{ img.name }}" data-folder="{{ folder or '' }}"><img src="{{ img.url }}" alt="{{ img.name }}"></a>
          <div class="img-actions">
            <button class="btn-exif" data-folder="{{ folder }}" data-filename="{{ img.name }}">EXIF</button>
            <form action="/gallery/{{ folder }}/delete_image" method="post" class="ajax-form ajax-delete-image">
              <input type="hidden" name="filename" value="{{ img.name }}">
              <button type="submit">Remove</button>
            </form>
          </div>
        </figure>
      {% endfor %}
      </div>
    {% else %}
      <p>No images in this folder yet.</p>
    {% endif %}
  {% else %}
    <h1>Gallery</h1>
    <form action="/gallery/create_folder" method="post" class="ajax-form ajax-create-folder">
      <label>Create folder: <input name="name" placeholder="Folder name"></label>
      <button type="submit">Create</button>
    </form>
    {% if folders %}
      <h2>Folders</h2>
      <div class="folder-list">
        {% for f in folders %}
          <div class="folder-card">
            <a href="/gallery?folder={{ f.name }}">{{ f.name }}</a>
            <div class="folder-preview">
              {% for p in f.previews %}
                <a href="/gallery?folder={{ f.name }}" class="preview-link"><img src="{{ p.url }}" alt="{{ p.name }}"></a>
              {% endfor %}
            </div>
          </div>
        {% endfor %}
      </div>
    {% endif %}
    {% if images %}
      <h2>Root images</h2>
      <div class="grid">
      {% for img in images %}
        <figure>
          <a href="{{ img.url }}" class="img-link" data-full="{{ img.url }}" data-filename="{{ img.name }}" data-folder=""><img src="{{ img.url }}" alt="{{ img.name }}"></a>
        </figure>
      {% endfor %}
      </div>
    {% else %}
      <p>No images yet. <a href="/upload">Upload one</a>.</p>
    {% endif %}
  {% endif %}
  <!-- AI chat widget (bottom-right) -->
  <div id="ai-chat-widget" style="position:fixed;right:12px;bottom:12px;width:320px;z-index:9999">
    <div class="ai-widget" style="box-shadow:0 6px 18px rgba(0,0,0,0.12);border-radius:8px;overflow:hidden;background:#fff">
      <div style="background:#222;color:#fff;padding:8px;font-weight:bold">Assistant</div>
      <div id="chatbox" style="height:200px;overflow:auto;padding:8px"></div>
      <form id="chatForm" style="display:flex;padding:8px;border-top:1px solid #eee">
        <input id="msg" placeholder="Ask the assistant..." autocomplete="off" style="flex:1;padding:6px;margin-right:6px">
        <button type="submit">Send</button>
      </form>
      <div style="padding:8px;border-top:1px solid #f1f1f1;text-align:right">
        <button id="undoAiBtn" style="font-size:12px">Undo last AI action</button>
      </div>
    </div>
  </div>
{% endblock %}

{% block scripts %}
  <script src="/static/js/gallery.js" defer></script>
{% endblock %}
 
